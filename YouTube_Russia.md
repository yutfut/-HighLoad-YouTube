# YouTube Russia

## RPS
Мировой DAU 122 млн.\
Россия DAU 12 млн, что составляет ориентировочно 10%.

Nginx 154 194 rps.\
Backend 9 095.

## БД

### USER

| **Название поля**      | **Память**                     |
| -----------------------| -------------------------------|
| id_user                | 4 байт                         |
| Nickname               | 20 сиволов = 20 байт           |
| Email                  | 20 сиволов = 20 байт           |
| Password               | 32 байт                        | 
| Avatar_path            | 32 байт                        |

Итого 108 байт

> 12 млн * 108 байт = 1 296 млн байт => 1 265 625 Кбайт => 1 235 Мбайт => 1.2 Гбайт.

### LIKE

| **Название поля**      | **Память**                     |
| -----------------------| -------------------------------|
| id_like                | 4 байт                         |
| id_user                | 4 байт                         |
| id_video               | 4 байт                         |

Итого 12 байт

> Пользователь ставит 6 Лайк в месяц => 12 *6  = 72 лайка в год => 72 * 10 => 720 лайков за 10 лет ставит один пользователь.

> 720 * 12 млн пользователей => 8 640 млн лайков за 10 лет.

> 8 640 млн * 12 байт = 103 680 млн байт => 101 250 000 Кбайт = 98 876 Мбайт = 96 Гбайт.

### VIDEO

| **Название поля**      | **Память**                         |
| -----------------------| -----------------------------------|
| id_video               | 4 байт                             |
| Title                  | 256 сиволов = 256 байт             |
| Description            | 1024 сиволов = 1024 байт           |
| path_to_video          | 32 байт                            | 
| count_of_likes         | 4 байт                             |
| count_of_views         | 4 байт                             |
| date_of_publication    | 8 байт                             |

Итого 1332 байт

Если сохранять пропорцию, что пользователи составляют 10% от мирового, то получим что ежечасно загружается 500 * 10% = 50 часов видео.
Видео в среднем имеет длительность 8.4 минуты => 50 * 60 = 3000 минут => 3000 / 8.4 = 357 видео загружается ежечасно.

> 357 * 24 = 8 568 видео в день.

> 8 568 * 365 = 3 127 320 видео в год.

> 3 127 320 * 10 = 31 273 200 видео за 10 лет.

> 31 273 200 видео за 10 лет * 1332 байт = 41 655 902 400 байт => 40679592 Кбайт => 39726 Мбайт => 38.8 Гбайт.

### COMMENT

| **Название поля**      | **Память**                         |
| -----------------------| -----------------------------------|
| id_comment             | 4 байт                             |
| Text                   | 1024 сиволов = 1024 байт           |
| date_of_duplication    | 8 байт                             | 
| id_user                | 4 байт                             |
| id_video               | 4 байт                             |

Итого 1044 байт

> Пользователь оставляет 1 комментарий в месяц => 12 комментариев в год => 120 комментариев за 10 лет.

> 120 * 12 млн = 1440 млн комментариев.

> 1440 млн * 1044 байт = 1 503 360 млн байт => 1468125000 Кбайт => 1433715 Мбайт => 1400 Гбайт.

Всего получается 1400 + 38.8 + 96 + 1.2 = 1 536 Гб.

В конфигурации сервера Postgresql 8 дисков по 8 Тб => 64 Тб.

1400 Гб / 64 Тб = 1 сервер.

Если учесть что у каждого сервера Postgresql минимум 2 slave => 1 + 1 * 2 = 3 серверов Posgresql

Хранение видео

Мы выяснили что пользователи ежечасно загружают 50 часов видео.
1 час видео весит 8 Гб

> 50 * 8 = 400 Гб ежечасно

> 400 * 24 = 9600 Гб видео в сутки

> 9600 * 365 = 3504000 Гб видео в год

> 3504000 * 10 = 35 040 000 Гб видео за 10 лет

> 35 040 000 Гб => 34 228 Тб

В конфигурации сервера хранящего видео на HDD 8 дисков по 8 Тб => 64 Тб.

> 34 228 / 64 = 535 серверов для хранения видео на HDD
К тому же мы не храним видео в одном экземаляре =>  535 * 2 = 1 070 серверов для хранения видео на HDD

## ДЦ
Предельная нагрузка на одно ядро бека 50 rps.\
Предельная нагрузка на одно ядра фронта 250 rps.

154 194 / 250 = 617 ядер.\
617 / 32 = 20 машин.

9 095 / 50 = 182.\
182 / 32 = 6.

Для России сделаем два ДЦ в Москве и Санкт-Петербурге.\
В 1 ДЦ.

|**Тип сервера**|**Кол-во машин**|**Кол-во резерва**|
| --------------| ---------------| -----------------|
| Nginx         | 20             | 5                |
| Backend       | 6              | 3                |
| Redis         | 1              | 2 Slave          |
| Postgresql    | 1              | 2 Slave          |
| Хранение HDD  | 1 070          |                  |